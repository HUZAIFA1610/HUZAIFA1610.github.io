---
import Layout from "../layouts/Layout.astro";
import { projects } from "../data/projects";

const categories = ["All", ...Array.from(new Set(projects.map((p) => p.category)))];
---


<Layout
  title="Projects | Mohammad Abu Huzaifa"
  description="Selected data analytics projects: dashboards, EDA, predictive insights, and reporting."
>
  <h1 class="text-3xl font-semibold tracking-tight">Projects</h1>
  <p class="mt-2 text-slate-300 max-w-2xl">
    Curated projects with clear problem framing, approach, and measurable outcomes.
  </p>

  <div class="mt-6 flex flex-wrap gap-2" id="project-filters">
    {categories.map((c) => (
      <button
        type="button"
        data-filter={c}
        class="rounded-full border border-white/10 bg-white/5 px-4 py-2 text-sm text-slate-200 hover:bg-white/10 transition"
      >
        {c}
      </button>
    ))}
  </div>

  <div class="mt-8 grid gap-4 sm:grid-cols-2 lg:grid-cols-3">
  {projects.map((p) => (
    <article
      class="rounded-xl border border-white/10 bg-white/5 overflow-hidden hover:bg-white/10 transition"
      data-category={p.category}
    >
      <a href={`/projects/${p.slug}`} class="block">
        <div class="aspect-[16/9] bg-black/30 overflow-hidden">
          <img
            src={p.coverImage}
            alt={`${p.title} cover`}
            class="h-full w-full object-cover opacity-90"
            loading="lazy"
            onerror="this.onerror=null;this.src='/images/placeholder.svg';"
          />
        </div>

        <div class="p-5">
          <div class="text-xs text-slate-400">{p.category} • {p.dataset}</div>
          <div class="mt-1 font-semibold">{p.title}</div>
          <div class="mt-2 text-sm text-slate-300">{p.oneLiner}</div>
        </div>
      </a>

      <div class="px-5 pb-5 flex gap-3">
        <a class="text-sm text-sky-400 hover:underline" href={`/projects/${p.slug}`}>
          Case study →
        </a>
        <a class="text-sm text-slate-300 hover:text-white" href={p.repoUrl} target="_blank">
          GitHub →
        </a>
      </div>
    </article>
  ))}
  </div>
  <script>
    const filtersEl = document.getElementById("project-filters");
    const buttons = filtersEl ? Array.from(filtersEl.querySelectorAll("button[data-filter]")) : [];
    const cards = Array.from(document.querySelectorAll("article[data-category]"));

    function setActiveButton(value) {
      for (const btn of buttons) {
        const isActive = btn.dataset.filter === value;
        btn.classList.toggle("bg-white/10", isActive);
        btn.classList.toggle("border-white/20", isActive);
        btn.classList.toggle("text-white", isActive);
      }
    }

    function applyFilter(value) {
      const selected = value || "All";

      for (const card of cards) {
        const cat = card.getAttribute("data-category");
        const show = selected === "All" || cat === selected;
        card.style.display = show ? "" : "none";
      }

      setActiveButton(selected);

      // Update URL like /projects?cat=BI%20Dashboard (without reloading)
      const url = new URL(window.location.href);
      if (selected === "All") url.searchParams.delete("cat");
      else url.searchParams.set("cat", selected);
      window.history.replaceState({}, "", url);
    }

    // Read initial filter from URL (?cat=...)
    const initial = new URL(window.location.href).searchParams.get("cat") || "All";
    applyFilter(initial);

    // Click handling
    for (const btn of buttons) {
      btn.addEventListener("click", () => applyFilter(btn.dataset.filter || "All"));
    }
  </script>
</Layout>